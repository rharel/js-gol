!function(){function a(a,b){this._width=a,this._height=b,this._cells={},this._neighbours={},this._dirty={},this._population=0,this._spawned=[],this._died=[]}a.prototype={constructor:a,_isOutside:function(a,b){return 0>a||a>=this._width||0>b||b>=this._height},_setDirty:function(a,b){this._dirty.hasOwnProperty(a)||(this._dirty[a]={}),this._dirty[a][b]=!0},_addNeighbour:function(a,b){a=a===this._width?0:-1===a?this._width-1:a,b=b===this._height?0:-1===b?this._height-1:b,this._neighbours.hasOwnProperty(a)||(this._neighbours[a]={}),this._neighbours[a].hasOwnProperty(b)||(this._neighbours[a][b]=0),this._neighbours[a][b]+=1,this._setDirty(a,b)},_removeNeighbour:function(a,b){a=a===this._width?0:-1===a?this._width-1:a,b=b===this._height?0:-1===b?this._height-1:b,this._neighbours[a][b]-=1,0===this._neighbours[a][b]&&delete this._neighbours[a][b],this._setDirty(a,b)},get:function(a,b){if(this._cells.hasOwnProperty(a)){var c=this._cells[a];if(c.hasOwnProperty(b))return!0}return!1},spawn:function(a,b){return this._isOutside(a,b)||this.get(a,b)?!1:(this._cells.hasOwnProperty(a)||(this._cells[a]={}),this._cells[a][b]=!0,++this._population,this._addNeighbour(a-1,b-1),this._addNeighbour(a-1,b),this._addNeighbour(a-1,b+1),this._addNeighbour(a,b-1),this._addNeighbour(a,b+1),this._addNeighbour(a+1,b-1),this._addNeighbour(a+1,b),this._addNeighbour(a+1,b+1),this._setDirty(a,b),!0)},kill:function(a,b){return this._isOutside(a,b)||!this.get(a,b)?!1:(delete this._cells[a][b],--this._population,this._removeNeighbour(a-1,b-1),this._removeNeighbour(a-1,b),this._removeNeighbour(a-1,b+1),this._removeNeighbour(a,b-1),this._removeNeighbour(a,b+1),this._removeNeighbour(a+1,b-1),this._removeNeighbour(a+1,b),this._removeNeighbour(a+1,b+1),this._setDirty(a,b),!0)},_step_single:function(a,b){var c=this.get(a,b),d=+c;return this._neighbours.hasOwnProperty(a)&&this._neighbours[a].hasOwnProperty(b)&&(d+=this._neighbours[a][b]),3===d?!0:4===d?c:!1},step:function(){this._spawned=[],this._died=[];for(var a in this._dirty)if(this._dirty.hasOwnProperty(a)){var b=this._dirty[a];for(var c in b)if(b.hasOwnProperty(c)){var d=this._step_single(a,c);d&&!this.get(a,c)?this._spawned.push({x:+a,y:+c}):!d&&this.get(a,c)&&this._died.push({x:+a,y:+c})}}this._dirty={},this._spawned.forEach(function(a){this.spawn(a.x,a.y)}.bind(this)),this._died.forEach(function(a){this.kill(a.x,a.y)}.bind(this))},traverse:function(a){var b=!1;for(var c in this._cells)if(this._cells.hasOwnProperty(c))for(var d in this._cells[c])if(this._cells[c].hasOwnProperty(d)&&(b=a(c,d)),b)return},get width(){return this._width},get height(){return this._height},get population(){return this._population}},"undefined"!=typeof exports?exports.World=a:"undefined"!=typeof window&&(window.Gol={World:a})}();