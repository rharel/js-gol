!function(){function a(b){this._hash=b||a.HASH_IDENTITY,this._items={}}function b(a){this._hash=a||function(a){return a},this._kv={}}function c(a){return Math.round(a.x)+","+Math.round(a.y)}function d(d,e,f){this._width=d,this._height=e,this._is_wrapped="undefined"!=typeof f?f:!1,this._live_cells=new a(c),this._neighbour_count=new b(c),this._dirty=new a(c),this._population=0}a.HASH_IDENTITY=function(a){return a},a.prototype={constructor:a,contains:function(a){return this._items.hasOwnProperty(this._hash(a))},add:function(a){this._items[this._hash(a)]=a},remove:function(a){delete this._items[this._hash(a)]},clear:function(){this._items={}},enumerate:function(a){var b,c;for(b in this._items)if(this._items.hasOwnProperty(b)&&(c=this._items[b],a(c)))return}},b.prototype={constructor:b,contains:function(a){return this._kv.hasOwnProperty(this._hash(a))},get:function(a){return this._kv[this._hash(a)]},set:function(a,b){this._kv[this._hash(a)]=b},remove:function(a){delete this._kv[this._hash(a)]},clear:function(){this._kv={}},enumerate:function(a){var b,c;for(b in this._kv)if(this._kv.hasOwnProperty(b)&&(c=this._kv[b],a(c)))return}},d.prototype={constructor:d,is_out_of_bounds:function(a,b){return 0>a||a>=this._width||0>b||b>=this._height},_add_neighbour:function(a,b){if(this._is_wrapped||!this.is_out_of_bounds(a,b)){a=a===this._width?0:-1===a?this._width-1:a,b=b===this._height?0:-1===b?this._height-1:b;var c={x:a,y:b};this._neighbour_count.contains(c)||this._neighbour_count.set(c,0),this._neighbour_count.set(c,this._neighbour_count.get(c)+1),this._dirty.add(c)}},_remove_neighbour:function(a,b){if(this._is_wrapped||!this.is_out_of_bounds(a,b)){a=a===this._width?0:-1===a?this._width-1:a,b=b===this._height?0:-1===b?this._height-1:b;var c={x:a,y:b};this._neighbour_count.contains(c)&&this._neighbour_count.set(c,this._neighbour_count.get(c)-1),this._neighbour_count.get(c)<=0&&this._neighbour_count.remove(c),this._dirty.add(c)}},spawn:function(a,b){if(this.is_out_of_bounds(a,b)||this.inspect(a,b))return!1;var c={x:a,y:b};return this._live_cells.add(c),++this._population,this._add_neighbour(a-1,b-1),this._add_neighbour(a-1,b),this._add_neighbour(a-1,b+1),this._add_neighbour(a,b-1),this._add_neighbour(a,b+1),this._add_neighbour(a+1,b-1),this._add_neighbour(a+1,b),this._add_neighbour(a+1,b+1),this._dirty.add(c),!0},kill:function(a,b){if(this.is_out_of_bounds(a,b)||!this.inspect(a,b))return!1;var c={x:a,y:b};return this._live_cells.remove(c),--this._population,this._remove_neighbour(a-1,b-1),this._remove_neighbour(a-1,b),this._remove_neighbour(a-1,b+1),this._remove_neighbour(a,b-1),this._remove_neighbour(a,b+1),this._remove_neighbour(a+1,b-1),this._remove_neighbour(a+1,b),this._remove_neighbour(a+1,b+1),this._dirty.add(c),!0},_step_single:function(a,b){var c={x:a,y:b},d=this.inspect(a,b),e=+d;return this._neighbour_count.contains(c)&&(e+=this._neighbour_count.get(c)),3===e?!0:4===e?d:!1},step:function(){var a,b,c=[],d=[];this._dirty.enumerate(function(e){b=this.inspect(e.x,e.y),a=this._step_single(e.x,e.y),a&&!b?c.push(e):!a&&b&&d.push(e)}.bind(this)),this._dirty.clear(),c.forEach(function(a){this.spawn(a.x,a.y)}.bind(this)),d.forEach(function(a){this.kill(a.x,a.y)}.bind(this))},inspect:function(a,b){return this._live_cells.contains({x:a,y:b})},inspect_all:function(a){this._live_cells.enumerate(a)},get width(){return this._width},get height(){return this._height},get is_wrapped(){return this._is_wrapped},set is_wrapped(a){this._is_wrapped=!!a},get population(){return this._population}},"undefined"!=typeof exports?exports.World=d:"undefined"!=typeof window&&(window.Gol={World:d})}();